<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{base}">

<head>
<title>Upload</title>
</head>
<div layout:fragment="page_content" id="page_content">
	<form method="post" action="/" name="getPagedDataFrm"
		id="getPagedDataFrm"></form>
	<br />
	<div class="upload-content">
		<div class="single-upload">
			<form id="fileUploadForm" name="fileUploadForm">
				<input id="fileUploadInput" type="file" name="file"
					class="file-input" required />
				<button type="submit" class="primary submit-btn">Submit</button>
			</form>
			<div class="upload-response">
				<div id="fileUploadError"></div>
				<div id="fileUploadSuccess"></div>
			</div>
		</div>
	</div>
	<br />
	<div class="row" th:fragment="getPagedData"
		th:if="${fileDetailsList != null && !fileDetailsList.isEmpty()}">
		<div class="col-lg-12">
			<table id="link-list" class="table table-striped table-bordered"
				style="width: 100%">
				<thead>
					<tr>
						<th colspan="5">
							<form id="srchFrm" name="srchFrm" action="/getSearchData"
								class="form-inline">
								<div class="form-group mx-sm-3 mb-2">
									<input type="text" class="form-control" id="fileName"
										name="fileName" placeholder="File Name" required>
								</div>
								<button type="submit" class="btn btn-primary mb-2 mr-2">Search</button>
								<button type="button" class="btn btn-primary mb-2"
									onclick="return refreshPage();">Refresh</button>
							</form>
						</th>
					</tr>
					<tr>
						<th>File Name</th>
						<th>Checksum</th>
						<th>Type</th>
						<th>Size</th>
						<th>Status</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="obj,iterStat : ${fileDetailsList}">
						<td th:text="${{obj.fileName}}"></td>
						<td th:text="${{obj.checksum}}"></td>
						<td th:text="${{obj.fileType}}"></td>
						<td th:text="${{obj.size}}"></td>
						<td th:if="${obj.status == null || obj.status == 0}">In
							Progress</td>
						<td th:if="${obj.status == 1}"><button type="button"
								class="primary submit-btn" data-toggle="modal"
								th:data-target="'#STATUS'+${iterStat.index}">View
								Summary</button>

							<div class="modal fade" th:id="'STATUS'+${iterStat.index}"
								tabindex="-1" role="dialog"
								th:aria-labelledby="'STATUS'+${iterStat.index}"
								aria-hidden="true">
								<div class="modal-dialog modal-lg" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLongTitle">File
												Summary</h5>
											<button type="button" class="close" data-dismiss="modal"
												aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											<div class="col-lg-12">
												<table class="table table-striped">
													<thead>
														<tr>
															<th colspan="5">Process Details</th>
														</tr>
														<tr>
															<th scope="col">File Upload Start</th>
															<th scope="col">Validation Completion</th>
															<th scope="col">Insertion Completion</th>
															<th scope="col">Summary Start</th>
															<th scope="col">Summary Completion</th>
														</tr>
													</thead>
													<tbody>
														<tr>
															<td th:text="${obj.processStartDT}"></td>
															<td th:text="${obj.dataCollectionDT}"></td>
															<td th:text="${obj.processEndDT}"></td>
															<td th:text="${obj.summaryStartDT}"></td>
															<td th:text="${obj.summaryEndDT}"></td>
														</tr>
													</tbody>
												</table>
												<br />
												<table class="table table-striped">
													<thead>
														<tr>
															<th colspan="5">Count Info</th>
														</tr>
														<tr>
															<th scope="col">Total Records</th>
															<th scope="col">Valid Records</th>
															<th scope="col">Invalid Records</th>
														</tr>
													</thead>
													<tbody>
														<tr>
															<td th:text="${obj.totalRcds}"></td>
															<td th:text="${obj.totalValidRcds}"></td>
															<td th:text="${obj.totalInValidRcds}"></td>
														</tr>
													</tbody>
												</table>
												<br />
												<table class="table table-striped">
													<thead>
														<tr>
															<th colspan="5">Currency Summary</th>
														</tr>
														<tr>
															<th scope="col">Order Currency</th>
															<th scope="col">Amount</th>
														</tr>
													</thead>
													<tbody>
														<tr th:each="cs: ${obj.transactionsSummary}">
															<td th:text="${cs.orderingCurrency}"></td>
															<td
																th:text="${#numbers.formatDecimal(cs.dealAmount, 10, 3)}"></td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary"
												data-dismiss="modal">Close</button>
										</div>
									</div>
								</div>
							</div></td>

						<td th:if="${obj.status == 2}">Failed</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<div class="row" th:fragment="pagination">
		<div class="col-md-2"></div>
		<div class="col-md-8">
			<nav aria-label="Pagination">
				<ul class="pagination justify-content-center">
					<li class="page-item" th:each="pageNumber : ${pageNumbers}"><a
						class="page-link" th:href="@{|/getPagedData/${pageNumber}|}"
						th:text=${pageNumber}>1</a></li>
				</ul>
			</nav>
		</div>
		<div class="col-md-2"></div>
	</div>
	<script th:src="@{/app/js/app.js}"></script>
</div>